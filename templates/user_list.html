{% load static %}


<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
<div id="mapid" style="width: 100%; height: 100%"></div>
{% for user in users %}
    <p>{{ user.first_name }} {{ user.last_name }} ({{ user.email }})</p>
{% endfor %}
</body>
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"></script>
<script src="https://leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"/>
<script src="{% static 'js/view_map.js' %}"></script>
<script type="text/javascript">

    var addressPoints = [];


    var tiles = L.tileLayer('//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="//openstreetmap.org/copyright">OpenStreetMap</a> contributors, Points &copy 2012 LINZ'
    });

    var map = L.map('mapid', {
        center: L.latLng(38.286, 35.681),
        zoom: 15,
        layers: [tiles]
    });

    var mcg = L.markerClusterGroup({
        chunkedLoading: true,
        //singleMarkerMode: true,
        spiderfyOnMaxZoom: false
    });

    fetch('api/kayiplar')
        .then(response => response.json())
        .then(points => points.map((i) => {
            var a = i;
            var title = i.kayip_first_name + "-" + i.kayip_first_name + "-" + i.kayip_last_name;
            var marker = L.marker(new L.LatLng(i.cordinate_x, i.cordinate_y), {title: title});
            marker.bindPopup(title);
            mcg.addLayer(marker);
        }))

    map.addLayer(mcg);

</script>
</html>
