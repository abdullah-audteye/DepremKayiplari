{% load static %}

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <!-- Modal -->
    <div id="mapid" style="width: 100%; height: 100%"></div>
    
  </body>
   <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"></script>
  <script src="https://leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <link
    rel="stylesheet"
    href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css"
  />
  <link
    rel="stylesheet"
    href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css"
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
  />
   <script type="text/javascript">

    var addressPoints = [];

    var tiles = L.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution:
        '&copy; <a href="//openstreetmap.org/copyright">OpenStreetMap</a> contributors, Points &copy 2012 LINZ',
    });

    var map = L.map("mapid", {
      center: L.latLng(38.286, 35.681),
      zoom: 15,
      layers: [tiles],
    });

    var mcg = L.markerClusterGroup({
      chunkedLoading: true,
      //singleMarkerMode: true,
      spiderfyOnMaxZoom: false,
    });
    var LeafIcon = L.Icon.extend({
      options: {
        iconSize: [24, 24],
        shadowSize: [50, 64],
        iconAnchor: [11, 94],
        shadowAnchor: [4, 62],
        popupAnchor: [0, -86],
      },
    });
    var greenIcon = new LeafIcon({
      iconUrl:
        "https://mt.googleapis.com/vt/icon/name=icons/onion/123-red-dot.png",
    });

    fetch("api/kayiplar")
      .then((response) => response.json())
      .then((points) =>
        points.map((i) => {
          var title = i.kayip_user[0].kayip_first_name + "-" + i.kayip_user[0].kayip_last_name + "-";
          var marker = L.marker(new L.LatLng(i.kayip_user[0].cordinate_x, i.kayip_user[0].cordinate_y), {
            icon: greenIcon,
            title: title,
          });
          marker.bindPopup(
            '<div class="row"><div class="col-12"><h3>Kayıp Bilgileri</h3></div><div class="col-12"><h5>isim:' +
              " " +
              i.kayip_user[0].kayip_first_name +
              " " +
              i.kayip_user[0].kayip_last_name +
              '</h5></div><div class="col-12"><h5>Adres:' +
              " " +
              i.kayip_user[0].address +
              '</h5></div><div class="col-12"><h5>Detay:' +
              " " +
              i.kayip_user[0].detail +
              '</h5></div><div style="border-top:1px solid gray;padding-top:5px;" class="col-12"><h4>İhbar Eden Bilgisi</h4></div><div class="col-12"><h6>isim:' +
              " " +
              i.ihbar_user.ihbar_first_name +
              " " +
              i.ihbar_user.ihbar_last_name +
              '</h6></div><div class="col-12"><h6>Telefon:' +
              " " +
              i.ihbar_user.phonenumber +
              "</h6></div></div>",
            {
              maxWidth: 560,
            }
          );
          mcg.addLayer(marker);
        })
      );
    map.addLayer(mcg);
  </script>

</html>
