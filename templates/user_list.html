{% load static %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
<div id="mapid" style="width: 100%; height: 100%"></div>
{% for user in users %}
    <p>{{ user.first_name }} {{ user.last_name }} ({{ user.email }})</p>
{% endfor %}
</body>
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"></script>
<script src="https://leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"/>
<script src="{% static 'js/view_map.js' %}"></script>
<script type="text/javascript">
var map = L.map('mapid').setView([38.286, 35.681], 15);

var apikey = 'f4d3e21d4fc14954a1d5930d4dde3809'
var markers = L.markerClusterGroup({
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    zoomToBoundsOnClick: true
});

L.tileLayer(
    'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18
    }).addTo(map);


var pUrl = "https://landsd.azure-api.net/dev/ogc/wfs/loc/geocomm?request=GetFeature&outputFormat=application/json&srsName=EPSG:4326&CQL_filter=class='SCH'&key=" + apikey;
// Use jQuery to load date from GeoJSON file

console.log("{{users}}",'usersss')

$.getJSON(pUrl, function (data) {
    var geoJsonLayer = L.geoJson(data, {
        filter: function (feature, layer) {
            return true;
            return (feature.properties.type == "PRS");
        },
        pointToLayer: function (feature, latlng) {
            var label = '<h4>' + feature.properties.ename + '<br>' + feature.properties.cname + '</h4>';
            label += feature.properties.e_address + '<br>';
            label += feature.properties.c_address + '<br>';

            var pMarker = new L.Marker(latlng, {
                title: feature.properties.cname
            });
            pMarker = new L.CircleMarker(latlng, {
                title: feature.properties.cname,
                radius: 5,
                color: '#FFFFFF',
                weight: 2,
                fillOpacity: 0.5,
                fillColor: 'green'
            });
            pMarker.bindPopup(label);
            markers.addLayer(pMarker);
            return pMarker;
        }
    });

    // Add geoJsonLayer to markercluster group

    markers.on('clusterclick', function (a) {
        console.log('Cluster Clicked:' + a);
    });
    markers.on('click', function (a) {
        console.log('Marker Clicked:' + a);
    });

    // Add the markercluster group to the map
    map.addLayer(markers);
});

</script>
</html>
